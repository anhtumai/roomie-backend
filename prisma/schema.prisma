// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
	provider = "postgresql"
	url      = env("DATABASE_URL")
}

generator client {
	provider = "prisma-client-js"
}

model Account {
	@@map(name: "account")
	id			Int				@id @default(autoincrement())
	username	String			@unique @db.VarChar(30)
	name		String			@db.VarChar(50)
	password	String

	apartment	Apartment?
	memberships	Membership[]
	invitors	Invitation[]	@relation("Invitor")
	invitees	Invitation[]	@relation("Invitee")
}

model Apartment {
	@@map(name: "apartment")
	id			Int     @id @default(autoincrement())
	name		String	@unique @db.VarChar(30)
	admin		Account @relation(fields: [adminId], references: [id])
	adminId		Int

	members		Membership[]
	invitations	Invitation[]
}

model Membership {
	@@map(name: "membership")
	member     Account   @relation(fields: [memberId], references: [id])
	memberId   Int
	apartment   Apartment @relation(fields: [apartmentId], references: [id])
	apartmentId Int
	@@id([memberId, apartmentId])
}

model Invitation {
	@@map(name: "invitation")
	id          Int       @id @default(autoincrement())
	invitor		Account		@relation("Invitor", fields: [invitorId], references: [id])
	invitorId	Int
	invitee		Account		@relation("Invitee", fields: [inviteeId], references: [id])
	inviteeId	Int
	apartment	Apartment	@relation(fields: [apartmentId], references: [id])
	apartmentId	Int
	@@unique(fields: [invitorId, inviteeId])
}
